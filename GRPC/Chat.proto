syntax = "proto2";
import "google/protobuf/timestamp.proto";

message Mensaje {
	required string idMensaje = 1;
	required Usuario remitente =2;
	required google.protobuf.Timestamp fechaEnvio = 3;
	required string contenido = 4;
	extensions 77 to 78;
}

message Archivo {
	extend Mensaje {
		optional Archivo archivo = 77;
	}
	required bytes contenido = 2;
	required string ruta = 3;
}

message Texto {
	extend Mensaje{
		optional Texto texto = 78;
	}
	required string contenido = 1;
	required bool editado = 2;
}

message Usuario {
	required string username = 1;
	required string idUsuario = 2;
		
}

message Conversacion{
	required string key = 1;
	repeated Usuario usuarios = 2;
	repeated Mensaje mensajes = 3;
}

message Empty{}

service Chat {
	rpc iniciarConversacion(Conversacion) returns (Empty);
	rpc recibirMensajes(Empty) returns (stream Mensaje);
	rpc enviarMensaje(Conversacion, stream Mensaje) returns (Empty);
}
	
	
